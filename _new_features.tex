\section{New Features Available in Stock Synthesis Version 3.30}

Stock Synthesis version 3.30 was designed specifically to provide more precise control in modeling temporal changes in biology, expected values for data, and for recruitment.  In addition, a large number of new features that make substantial changes to the input formats have been introduced.
		
\begin{center}
	{\renewcommand{\arraystretch}{1.5}%
	\begin{longtable}{p{1.75cm} p{9.5cm}}
		\hline
		Item &  Description\\
		\hline
		\endfirsthead
		\hline
		\toprule
		Item &  Description\\
		\hline
		\endhead

		\hline
		\endfoot

		\endlastfoot
		
		\multicolumn{1}{l}{\hyperlink{GenericFleets}{Generic Fleets}} & 
				Fleet specification section of data file has substantially changed and now includes specific fleet type; fishery fleets, bycatch fleets, and surveys which can be specified in any order.\\

		\multicolumn{1}{l}{\hyperlink{ListBased}{List-oriented inputs}} & 
			    Older versions of SS (3.24 and earlier) required users to specify the number of items to be read, now SS3 can determine the number of lines to read through the application of a terminator line using -9999 in first field of the read vector. \\
		  
		\multicolumn{1}{l}{\hyperlink{SubSeas}{Internal sub-seasons}} & 
			    SS3.24 inherently has 2 subseasons within each season (begin and middle) at which the age-length-key is calculated; now user specifies an even number of sub-seasons to use (2 to many). \\

		\multicolumn{1}{l}{\hyperlink{ObsTiming}{Observation Timing}} & 
			    Timing of observations now is input as year and month (e.g., April 15 is 4.5). The age-length-key used for each observation is calculated to the nearest sub-season month.  Old "survey\_timing" replaced by the month specific inputs.  Season is calculated at runtime from the input month and the input season durations. \\

		\multicolumn{1}{l}{\hyperlink{ALK}{Speed}} & 
			    Smarter at when to re-calculate the age-length-key; trims tails of size-at-age so calculations avoid many inconsequential cells of the age-length matrix. Age-length-key tail compression is specified in the starter file.\\
		
		\multicolumn{1}{l}{\hyperlink{Convert} {Converter}} & 
			    A special version of SS3, ss\_trans.exe, will read files in SS3.24 format and write *.ss\_new files in SS3.30 format.  This is the advised method for converting previous version files, but always do a side-by-side comparison of the old 3.24 model and the newly translated 3.30 model.\\

		\multicolumn{1}{l}{\hyperlink{WAAparm} {Weight-at-Age}} & Implementing empirical weight-at-age is now specified separately in the control file rather than under the maturity options.\\

		\multicolumn{1}{l}{\hyperlink{Priors}{Prior Type}} & Change in the prior numbering for parameters.  Now, 0 indicates no prior, and 6 indicates a normal distribution prior.\\
		
		\multicolumn{1}{l}{\hyperlink{CatchMult}{Catch multiplier}} & 
				Each fishing fleet's catch can now have a catchability (Q) that is a parameter in the mortality-growth parameter section.\\
				
		\multicolumn{1}{l}{\hyperlink{CatchFormat}{Catch input}} & 
				Catch input now as list:  year, season, fleet, amount, standard error. \\
				
		\multicolumn{1}{l}{\hyperlink{CompTiming}{Observations}} & 
				Fishery composition observations can be related to season long catch-at-age, or to a month-specific timing.\\
		
		\multicolumn{1}{l}{\hyperlink{DomeRetention}{Retention}} & 
				Option for dome-shaped retention function and for age-based retention. \\

		\multicolumn{1}{l}{Scaling Options} & 	
				New non-parametric selectivity types that are scaled by the raw values at particular ages, rather than the max age.\\
		\multicolumn{1}{l}{\hyperlink{2DAR}{2D AR Selectivity}} &
				Implementation of two-dimensional autoregressive selectivity implemented in SS3.30.10.\\

		\multicolumn{1}{l}{\hyperlink{SpecialSurvey}{Special survey types}} & 
				Special selectivity options (type 30 or $>$) are no longer specified within the control file.  Specifying the use of one of these selectivity types is now done within the data file by selecting the survey "units". \\  

		\multicolumn{1}{l}{\hyperlink{Qsetup}{Link functions}} & 
				Q\_power is now one of several, and growing, set of link functions for catchability. \\
				
		\multicolumn{1}{l}{\hyperlink{Qsetup}{Catchability setup}} & 
				Major reorganization of catchability (Q) setup, including the link specification. \\
			
		\multicolumn{1}{l}{\hyperlink{Qsetup}{Q as a parameter}} & 
				Each survey now must have a Q parameter and its value still can float (as old option 5).\\

		\multicolumn{1}{l}{\hyperlink{Shepherd}{Shepherd SRR}} & 
				The traditional 3-parameter Shepherd stock-recruitment curve is now an option.\\

%		\multicolumn{1}{l}{\hyperlink{Shepherd2}{Shepherd SRR re-parameterization}} & 
%				A re-parameterized 3-parameter Shepherd stock-recruitment curve, distinct from the traditional parameterization, is now an option in SS v.3.30.11 and higher.\\
			
		\multicolumn{1}{l}{\hyperlink{Ricker2}{Ricker SRR}} & 
				A 3-parameter Ricker stock-recruitment curve is now an option in SS3.30.11 and higher.\\

		\multicolumn{1}{l}{\hyperlink{RecrTiming}{Recruitment timing}} & 
				Replace "birthseason" with "settlement event" that has explicit timing offset from spawning. Month of spawning and each settlement event must be specified and need not be at beginning of a season.\\

		\multicolumn{1}{l}{Global MSY} &  
				Global MSY based on knife-edged age selection; also do calculation with single age selection. The global MSY value will automatically be included in the report file.\\
		
		\multicolumn{1}{l}{ Mean recruitment distribution} & 
				In multi-area model, can now specify range of years to use for the average recruitment distribution for forecasting. This feature is not yet implemented. \\

		\multicolumn{1}{l}{Process error} & 
				Propagate random walk in mortality growth parameters, catchability, and selectivity into forecast. Specifying the end year for process error in the forecast period will implement this option.  This option has only been partial implemented at this junction and will be completed in later versions.\\

		\multicolumn{1}{l}{\hyperlink{MGorder}{Parameter order}} & 
				Mortality growth parameters now have maturity, fecundity, sex ratio, and weight-length by growth pattern.\\
				
		\multicolumn{1}{l}{\hyperlink{SexRatio}{Sex ratio}} & 
			    Change sex ratio at birth from a constant to a morph-specific mortality growth parameter. This feature was not correctly implemented in SS3.30.11 and earlier. \\

		\multicolumn{1}{l}{\hyperlink{GrowthCessation}{Growth cessation}} & 
		    New growth option which allows for growth cessation, implemented in SS3.30.13. \\

		\multicolumn{1}{l}{\hyperlink{GcompVar}{Input variance adjuster}} & 
				Added variance adjustment factor for generalized size comp. \\
			
		\multicolumn{1}{l}{Deviation vectors} & 
				Variance of deviation vectors is now specified with 2 parameters for standard error and auto-correlation (rho), so can be estimated.\\
				
		\multicolumn{1}{l}{\hyperlink{Dirichlet}{Dirichlet multinomial}} & 
				Dirichlet multinomial now a fleet-specific option; takes one parameter per fleet. \\

		\multicolumn{1}{l}{\hyperlink{paraOrder}{Parameter order}} & The prior standard deviation column for all parameter lines has been moved before the prior type column.  This modification improves formatting output between integer and decimal inputs.\\ 

		\multicolumn{1}{l}{Density dependence} & 
				Beginning of year summary biomass and the recruitment deviation parameters are mapped to the "environmental" matrix so that parameters can be density-dependent based on environmental factors.\\
				
		\multicolumn{1}{l}{\hyperlink{tvOrder}{Re-order}} & 
				Pay attention to the new order of the time-varying adjustments to parameters (block/trend, then environmental, then deviations). \\
			
		\multicolumn{1}{l}{\hyperlink{time-vary}{Time-varying parameters}} & 
				Long parameter lines for spawner-recruit relationship (SRR), catchability (Q), and tag parameters and complete re-vamp of the way that time-varying parameters are implemented for SRR and Q.  Now shares same internal code as mortality-growth and selectivity parameters for time-varying capabilities.\\

		\multicolumn{1}{l}{Version numbering}	& The implementation of as new version control has changed how executable versions will be specified. The executable releases are now named SS3.3x.xx.xx representing, in order; major features, minor features, and code fixes. \\
		 \hline
	\end{longtable}}
\end{center}


\subsection{SS3.24 Issues Detected}
The process of updating and adding new features within SS3.30 exposed several issues with the previous version that have been corrected:
\begin{enumerate}
	\item Recruitment timing in multi-season models: When spawning occurred in a late season one year and recruits occurred at beginning of a season the next year, the recruits were starting at age-0, which was illogical.  SS3.30 corrects this so that recruits are age-0 only if recruiting at or between the time of spawning and the end of the year, and recruits after January 1st start at age-0.  A manual option in the control file allows users to replicate the SS3.24 protocol.
	
	\item Lorenzen $M$ and time-varying growth interaction: There needs to be a revision to SS3.30 so that growth can be updated each season prior to calculating Lorenzen $M$.
	
	\item Length at maximum age: SS3.24 intended to decay numbers at the maximum length over-time at $M + F$ decreasing the abundance of fish implicitly older than the maximum age (agemax).  However, this decay was only implemented in years for which time-varying growth was updated. 
	 
	\item SS3.24 had a lower bound of 1 when adjusting annual sample size (Nsamp) downward for composition data (length and age).  The variance adjustment factors specified in the control file are multiplied across all annual sample size values for each data source (fleet and composition type).  The issue with the lower bound of 1 resulted in sample size adjustment not being constant across small and large sample size years, possibly resulting in smaller samples have higher impact than may be desired.  SS3.30 has reduced this lower bound to a value of 0.001 but has retained user control over this value within the data file ("minsamplesize" column in the Composition Data Structure matrix at the top of the length and age data sections) to allow comparison with older model versions. 
\end{enumerate}